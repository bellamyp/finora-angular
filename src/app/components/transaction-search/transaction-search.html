<div class="container py-4">

  <h2 class="mb-4 fw-bold text-primary">Search Transactions</h2>

  <!-- SEARCH FORM -->
  <form [formGroup]="searchForm" (ngSubmit)="onSearch()" class="search-card">

    <div class="row g-3">

      <!-- Date Range -->
      <div class="col-md-3">
        <label class="form-label">Start Date</label>
        <input type="date" formControlName="startDate" class="form-control"/>
      </div>

      <div class="col-md-3">
        <label class="form-label">End Date</label>
        <input type="date" formControlName="endDate" class="form-control"/>
      </div>

      <!-- Amount Range -->
      <div class="col-md-3">
        <label class="form-label">Min Amount</label>
        <input type="number" step="0.01" formControlName="minAmount" class="form-control"/>
        <small class="text-muted">* Can be negative (e.g., -50.00)</small>
      </div>

      <div class="col-md-3">
        <label class="form-label">Max Amount</label>
        <input type="number" step="0.01" formControlName="maxAmount" class="form-control"/>
      </div>

      <!-- Bank Dropdown -->
      <div class="col-md-4">
        <label class="form-label">Bank</label>
        <select formControlName="bankId" class="form-select">
          <option value="">-- Select Bank --</option>
          <option *ngFor="let b of banks" [value]="b.id">{{ b.name }}</option>
        </select>
      </div>

      <!-- Brand Dropdown -->
      <div class="col-md-4">
        <label class="form-label">Brand</label>
        <select formControlName="brandId" class="form-select">
          <option value="">-- Select Brand --</option>
          <option *ngFor="let b of brands" [value]="b.id">{{ b.name }} ({{ b.location }})</option>
        </select>
      </div>

      <!-- Type Dropdown -->
      <div class="col-md-4">
        <label class="form-label">Type</label>
        <select formControlName="typeId" class="form-select">
          <option value="">-- Select Type --</option>
          <option *ngFor="let t of transactionTypes" [value]="t.id">{{ t.name }}</option>
        </select>
      </div>

      <!-- Keyword -->
      <div class="col-12">
        <label class="form-label">Notes contains</label>
        <input type="text" formControlName="keyword" class="form-control" placeholder="Search notes..."/>
      </div>

    </div>

    <button class="btn btn-primary mt-3 px-4">Search</button>
    <button type="button" class="btn btn-secondary mt-3 ms-2 px-4" (click)="onReset()">Reset</button>

  </form>

  <!-- RESULTS TABLE -->
  <div class="mt-5" *ngIf="searched">

    <h4 class="fw-bold mb-3">Results ({{ results.length }})</h4>

    <!-- Loading state -->
    <div *ngIf="loading" class="text-primary fs-5">
      <i class="bi bi-arrow-clockwise spin me-2"></i> Loading transactions...
    </div>

    <!-- No results -->
    <div *ngIf="!loading && results.length === 0" class="text-muted fs-5">
      <i class="bi bi-search"></i> No transactions found.
    </div>

    <!-- Results Table -->
    <table *ngIf="!loading && results.length > 0" class="table table-striped table-bordered table-fixed">
      <thead class="table-light">
      <tr>
        <th style="width: 80px;">ID</th>
        <th style="width: 100px;">Date</th>
        <th style="width: 100px;">Type</th>
        <th style="width: 150px;">Brand</th>
        <th style="width: 100px;">Amount</th>
        <th style="width: 250px;">Notes</th>
        <th style="width: 150px;">Bank</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let t of results" (click)="openTransactionGroup(t.groupId)" class="clickable-row">
        <td>{{ t.id }}</td>
        <td>{{ t.date }}</td>
        <td>{{ t.typeName }}</td>
        <td>{{ t.brandName }}</td>
        <td [ngClass]="{'text-danger': t.amount < 0}">${{ t.amount }}</td>
        <td class="notes-col" [title]="t.notes">{{ t.notes }}</td>
        <td>{{ t.bankName }}</td>
      </tr>
      </tbody>
    </table>
  </div>

</div>
